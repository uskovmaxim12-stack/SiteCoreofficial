<!DOCTYPE html>
<html>
<head>
    <title>Инициализация Gist SiteCore</title>
</head>
<body style="font-family: Arial, sans-serif; padding: 20px;">
    <h1>Инициализация базы данных SiteCore в Gist</h1>
    
    <div id="status" style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 5px;">
        Статус: Ожидание...
    </div>
    
    <button onclick="initGist()" style="padding: 10px 20px; font-size: 16px;">
        Инициализировать Gist
    </button>
    
    <script>
        const GIST_ID = '30dbe17ad2208d9eb8809574ee8ef012';
        const GIST_TOKEN = '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';
        
        async function initGist() {
            const status = document.getElementById('status');
            
            const defaultData = {
                users: {
                    clients: [],
                    developers: [
                        {
                            id: "dev_1",
                            name: "Максим",
                            password: "140612",
                            avatar: "М",
                            email: "maxim@sitecore.ru",
                            phone: "+7 (999) 123-45-67",
                            telegram: "@maxim_dev",
                            specialty: "Full-stack разработчик",
                            experience: "5 лет"
                        },
                        {
                            id: "dev_2",
                            name: "Александр",
                            password: "789563",
                            avatar: "А",
                            email: "alexander@sitecore.ru",
                            phone: "+7 (999) 987-65-43",
                            telegram: "@alexander_dev",
                            specialty: "Frontend разработчик",
                            experience: "3 года"
                        }
                    ]
                },
                orders: [],
                messages: []
            };
            
            try {
                status.innerHTML = 'Статус: Отправка запроса к GitHub...';
                
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${GIST_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        files: {
                            'gistfile1.txt': {
                                content: JSON.stringify(defaultData, null, 2)
                            }
                        }
                    })
                });
                
                if (response.ok) {
                    status.innerHTML = '✅ Статус: Gist успешно инициализирован!';
                    status.style.background = '#d4edda';
                    status.style.color = '#155724';
                    
                    // Показываем ссылку
                    const link = document.createElement('a');
                    link.href = 'index.html';
                    link.textContent = 'Перейти к системе SiteCore';
                    link.style.display = 'block';
                    link.style.marginTop = '20px';
                    link.style.fontSize = '18px';
                    link.style.color = '#007bff';
                    link.style.textDecoration = 'none';
                    status.appendChild(link);
                    
                } else {
                    const error = await response.text();
                    status.innerHTML = `❌ Статус: Ошибка ${response.status}`;
                    status.style.background = '#f8d7da';
                    status.style.color = '#721c24';
                    console.error('Ошибка:', error);
                }
            } catch (error) {
                status.innerHTML = `❌ Статус: Ошибка сети - ${error.message}`;
                status.style.background = '#f8d7da';
                status.style.color = '#721c24';
                console.error('Ошибка:', error);
            }
        }
        
        // Автоматически инициализируем при загрузке
        document.addEventListener('DOMContentLoaded', initGist);
    </script>
</body>
</html>
